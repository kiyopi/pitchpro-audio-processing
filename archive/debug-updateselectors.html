<!DOCTYPE html>
<html>
<head>
    <title>Debug updateSelectors Method</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
        .step { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <h1>ğŸ” updateSelectors Method Debug</h1>
    
    <div id="test-freq-1">0.0 Hz</div>
    <div id="test-freq-2">0.0 Hz</div>
    
    <div id="log"></div>
    
    <script src="dist/pitchpro.umd.js"></script>
    <script>
        const logDiv = document.getElementById('log');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `step ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            logDiv.appendChild(div);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        try {
            log('ğŸš€ ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            // Step 1: Basic checks
            log(`window.PitchPro å­˜åœ¨: ${!!window.PitchPro}`, window.PitchPro ? 'success' : 'error');
            
            if (!window.PitchPro) {
                log('PitchPro ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚', 'error');
                throw new Error('PitchPro not available');
            }
            
            // Step 2: Check exports
            const exports = Object.keys(window.PitchPro);
            log(`åˆ©ç”¨å¯èƒ½ãªã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ (${exports.length}å€‹): ${exports.join(', ')}`, 'info');
            
            // Step 3: Check AudioDetectionComponent
            const AudioDetectionComponent = window.PitchPro.AudioDetectionComponent;
            log(`AudioDetectionComponent å­˜åœ¨: ${!!AudioDetectionComponent}`, AudioDetectionComponent ? 'success' : 'error');
            
            if (!AudioDetectionComponent) {
                log('AudioDetectionComponent ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚', 'error');
                throw new Error('AudioDetectionComponent not found');
            }
            
            // Step 4: Create instance
            log('ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆä¸­...', 'info');
            const component = new AudioDetectionComponent({
                frequencySelector: '#test-freq-1',
                debug: true
            });
            log('ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ: âœ… æˆåŠŸ', 'success');
            
            // Step 5: Check method existence
            log(`updateSelectors ãƒ¡ã‚½ãƒƒãƒ‰å­˜åœ¨: ${typeof component.updateSelectors === 'function'}`, 
                typeof component.updateSelectors === 'function' ? 'success' : 'error');
                
            if (typeof component.updateSelectors !== 'function') {
                // List all available methods
                const methods = [];
                let obj = component;
                do {
                    Object.getOwnPropertyNames(obj)
                        .filter(name => typeof component[name] === 'function' && name !== 'constructor')
                        .forEach(name => {
                            if (!methods.includes(name)) methods.push(name);
                        });
                } while ((obj = Object.getPrototypeOf(obj)) && obj !== Object.prototype);
                
                log(`åˆ©ç”¨å¯èƒ½ãƒ¡ã‚½ãƒƒãƒ‰: ${methods.join(', ')}`, 'error');
                throw new Error('updateSelectors method not found');
            }
            
            // Step 6: Try calling updateSelectors
            log('updateSelectors ã‚’å‘¼ã³å‡ºã—ä¸­...', 'info');
            try {
                component.updateSelectors({
                    frequencySelector: '#test-freq-2'
                });
                log('updateSelectors å‘¼ã³å‡ºã—: âœ… æˆåŠŸ', 'success');
            } catch (err) {
                log(`updateSelectors å‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼: ${err.message}`, 'error');
                log(`ã‚¨ãƒ©ãƒ¼ã®è©³ç´°: ${err.stack}`, 'error');
                throw err;
            }
            
            // Step 7: Check if method actually exists on prototype
            log('ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ãƒã‚§ãƒ¼ãƒ³ã®è©³ç´°èª¿æŸ»...', 'info');
            const proto = Object.getPrototypeOf(component);
            const hasUpdateSelectors = proto.hasOwnProperty('updateSelectors');
            log(`ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã« updateSelectors å­˜åœ¨: ${hasUpdateSelectors}`, hasUpdateSelectors ? 'success' : 'error');
            
            if (hasUpdateSelectors) {
                const descriptor = Object.getOwnPropertyDescriptor(proto, 'updateSelectors');
                log(`updateSelectors descriptor: ${JSON.stringify({
                    configurable: descriptor.configurable,
                    enumerable: descriptor.enumerable,
                    writable: descriptor.writable,
                    isFunction: typeof descriptor.value === 'function'
                })}`, 'info');
            }
            
            log('ğŸ‰ ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã—ã¾ã—ãŸï¼', 'success');
            
        } catch (error) {
            log(`âŒ ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            log(`ã‚¨ãƒ©ãƒ¼ã‚¹ã‚¿ãƒƒã‚¯: ${error.stack}`, 'error');
            
            // Additional debugging
            if (window.PitchPro && window.PitchPro.AudioDetectionComponent) {
                try {
                    const instance = new window.PitchPro.AudioDetectionComponent();
                    log('ã‚¨ãƒ©ãƒ¼å¾Œã®è¿½åŠ ç¢ºèª:', 'info');
                    log(`ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆå¯èƒ½: ${!!instance}`, 'info');
                    log(`updateSelectorsã®å‹: ${typeof instance.updateSelectors}`, 'info');
                } catch (err) {
                    log(`è¿½åŠ ç¢ºèªã‚‚ã‚¨ãƒ©ãƒ¼: ${err.message}`, 'error');
                }
            }
        }
    </script>
</body>
</html>