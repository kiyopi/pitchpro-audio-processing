<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ğŸ“± PitchPro ãƒ¢ãƒã‚¤ãƒ«éŸ³é‡èª¿æ•´ãƒ†ã‚¹ãƒˆ v1.2.0.10-iPadéŸ³é‡20.0èª¿æ•´</title>
    <style>
        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            line-height: 1.6;
            min-height: 100vh;
            padding: 10px;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .device-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .controls {
            margin-bottom: 20px;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .slider-container {
            position: relative;
        }
        
        .slider {
            width: 100%;
            height: 40px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        
        .slider::-moz-range-thumb {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
            border: none;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        
        .slider-value {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #f44336, #d32f2f);
            color: white;
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        .volume-display {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .volume-bar-container {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .volume-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #FFC107, #F44336);
            transition: width 0.1s ease;
            border-radius: 10px;
        }
        
        .metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .metric {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px;
            border-radius: 8px;
            text-align: center;
        }
        
        .metric-label {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .metric-value {
            font-size: 18px;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .log-container {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .log-entry {
            font-family: 'Courier New', monospace;
            font-size: 11px;
            margin-bottom: 2px;
            word-break: break-all;
        }
        
        .log-debug { color: #90CAF9; }
        .log-info { color: #81C784; }
        .log-warn { color: #FFB74D; }
        .log-error { color: #E57373; }
        
        .hidden { display: none !important; }
        
        .status {
            text-align: center;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .status-ready { background: rgba(76, 175, 80, 0.3); }
        .status-testing { background: rgba(33, 150, 243, 0.3); }
        .status-error { background: rgba(244, 67, 54, 0.3); }
        
        @media (max-width: 480px) {
            .container {
                margin: 5px;
                padding: 15px;
            }
            
            .header h1 {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“± PitchPro ãƒ¢ãƒã‚¤ãƒ«èª¿æ•´</h1>
            <p>v1.2.0.10 iPadéŸ³é‡å¾©æ—§ (volumeMultiplier: 20.0) ğŸ¯50%â†’67%ç›®æ¨™</p>
        </div>
        
        <div id="device-info" class="device-info">
            <div><strong>ãƒ‡ãƒã‚¤ã‚¹:</strong> <span id="device-type">æ¤œå‡ºä¸­...</span></div>
            <div><strong>ãƒ–ãƒ©ã‚¦ã‚¶:</strong> <span id="browser-info">æ¤œå‡ºä¸­...</span></div>
            <div><strong>ç”»é¢:</strong> <span id="screen-info">æ¤œå‡ºä¸­...</span></div>
        </div>
        
        <div id="status" class="status status-ready">
            æº–å‚™å®Œäº† - è¨­å®šã‚’èª¿æ•´ã—ã¦ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label for="sensitivity-slider">Sensitivity (éŸ³é‡æ„Ÿåº¦)</label>
                <div class="slider-container">
                    <input type="range" id="sensitivity-slider" class="slider" 
                           min="1.0" max="25.0" step="0.5" value="20.0">
                    <span id="sensitivity-value" class="slider-value">20.0</span>
                </div>
            </div>
            
            <div class="control-group">
                <label for="noise-gate-slider">Noise Gate (ãƒã‚¤ã‚ºé™¤å»)</label>
                <div class="slider-container">
                    <input type="range" id="noise-gate-slider" class="slider" 
                           min="200" max="1000" step="50" value="500">
                    <span id="noise-gate-value" class="slider-value">500</span>
                </div>
            </div>
            
            <button id="apply-settings" class="btn btn-secondary">è¨­å®šã‚’é©ç”¨</button>
        </div>
        
        <div class="volume-display">
            <div class="volume-bar-container">
                <div id="volume-bar" class="volume-bar" style="width: 0%;"></div>
            </div>
            
            <div class="metrics">
                <div class="metric">
                    <div class="metric-label">éŸ³é‡</div>
                    <div id="volume-text" class="metric-value">0%</div>
                </div>
                <div class="metric">
                    <div class="metric-label">SCALING</div>
                    <div id="scaling-factor" class="metric-value">0</div>
                </div>
                <div class="metric">
                    <div class="metric-label">å‘¨æ³¢æ•°</div>
                    <div id="frequency-value" class="metric-value">---</div>
                </div>
                <div class="metric">
                    <div class="metric-label">ãƒãƒ¼ãƒˆ</div>
                    <div id="note-value" class="metric-value">---</div>
                </div>
            </div>
        </div>
        
        <button id="start-test" class="btn btn-primary">ğŸ¤ ãƒ†ã‚¹ãƒˆé–‹å§‹</button>
        <button id="stop-test" class="btn btn-danger hidden">â¹ï¸ ãƒ†ã‚¹ãƒˆåœæ­¢</button>
        
        <div class="log-container">
            <div><strong>ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°:</strong></div>
            <div id="log-output"></div>
        </div>
    </div>

    <!-- PitchPro UMDãƒ©ã‚¤ãƒ–ãƒ©ãƒª - å¼·åˆ¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥å›é¿ -->
    <script>
        // å¼·åˆ¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥å›é¿ç”¨ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
        const timestamp = new Date().getTime();
        const script = document.createElement('script');
        script.src = `../dist/pitchpro.umd.js?v=20250915-07&t=${timestamp}&r=${Math.random()}&force=${Date.now()}`;
        script.onload = function() {
            console.log('âœ… PitchPro library loaded with timestamp:', timestamp);
        };
        script.onerror = function() {
            console.error('âŒ Failed to load PitchPro library');
        };
        document.head.appendChild(script);
    </script>
    <script>
        // ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿å¾…æ©Ÿæ©Ÿèƒ½
        function waitForPitchPro() {
            return new Promise((resolve, reject) => {
                let attempts = 0;
                const maxAttempts = 50; // 5ç§’é–“å¾…æ©Ÿ
                
                const checkLibrary = () => {
                    attempts++;
                    if (typeof PitchPro !== 'undefined') {
                        console.log('âœ… PitchPro library loaded successfully after', attempts * 100, 'ms');
                        resolve();
                    } else if (attempts >= maxAttempts) {
                        console.error('âŒ PitchPro library not loaded after', maxAttempts * 100, 'ms');
                        reject(new Error('Library loading timeout'));
                    } else {
                        setTimeout(checkLibrary, 100);
                    }
                };
                
                checkLibrary();
            });
        }
        
        // ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿ç¢ºèª
        waitForPitchPro().catch(error => {
            document.body.innerHTML = '<div style="text-align:center;padding:50px;color:red;">âŒ PitchPro library loading failed<br>Please refresh the page</div>';
        });
    </script>
    
    <script>
        class MobileVolumeTest {
            constructor() {
                this.audioDetector = null;
                this.isRunning = false;
                this.currentSettings = {
                    sensitivity: 20.0,
                    noiseGateScaling: 500
                };
                
                this.initElements();
                this.initDeviceInfo();
                this.bindEvents();
                this.setupLogging();
            }
            
            initElements() {
                this.elements = {
                    sensitivitySlider: document.getElementById('sensitivity-slider'),
                    sensitivityValue: document.getElementById('sensitivity-value'),
                    noiseGateSlider: document.getElementById('noise-gate-slider'),
                    noiseGateValue: document.getElementById('noise-gate-value'),
                    applySettings: document.getElementById('apply-settings'),
                    startTest: document.getElementById('start-test'),
                    stopTest: document.getElementById('stop-test'),
                    status: document.getElementById('status'),
                    volumeBar: document.getElementById('volume-bar'),
                    volumeText: document.getElementById('volume-text'),
                    scalingFactor: document.getElementById('scaling-factor'),
                    frequencyValue: document.getElementById('frequency-value'),
                    noteValue: document.getElementById('note-value'),
                    logOutput: document.getElementById('log-output'),
                    deviceType: document.getElementById('device-type'),
                    browserInfo: document.getElementById('browser-info'),
                    screenInfo: document.getElementById('screen-info')
                };
            }
            
            initDeviceInfo() {
                // ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡º
                const userAgent = navigator.userAgent;
                let deviceType = 'PC';
                
                if (/iPhone/.test(userAgent)) {
                    deviceType = 'iPhone';
                    this.currentSettings.sensitivity = 20.0; // å¤§ããªå€¤ã§ç¢ºå®Ÿã«å¤‰åŒ–ã‚’ç¢ºèª
                } else if (/iPad/.test(userAgent)) {
                    deviceType = 'iPad';
                    this.currentSettings.sensitivity = 5.0;
                } else if (/Macintosh/.test(userAgent) && 'ontouchend' in document) {
                    deviceType = 'iPad (iPadOS)';
                    this.currentSettings.sensitivity = 5.0;
                } else if (/Android/.test(userAgent)) {
                    deviceType = 'Android';
                    this.currentSettings.sensitivity = 3.0;
                }
                
                this.elements.deviceType.textContent = deviceType;
                this.elements.browserInfo.textContent = this.getBrowserInfo();
                this.elements.screenInfo.textContent = `${window.screen.width}Ã—${window.screen.height}`;
                
                // ãƒ‡ãƒã‚¤ã‚¹ã«å¿œã˜ãŸåˆæœŸå€¤è¨­å®š
                this.elements.sensitivitySlider.value = this.currentSettings.sensitivity;
                this.elements.sensitivityValue.textContent = this.currentSettings.sensitivity.toString();
            }
            
            getBrowserInfo() {
                const userAgent = navigator.userAgent;
                if (userAgent.includes('Chrome')) return 'Chrome';
                if (userAgent.includes('Safari') && !userAgent.includes('Chrome')) return 'Safari';
                if (userAgent.includes('Firefox')) return 'Firefox';
                return 'Unknown';
            }
            
            bindEvents() {
                // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
                this.elements.sensitivitySlider.addEventListener('input', (e) => {
                    this.elements.sensitivityValue.textContent = e.target.value;
                });
                
                this.elements.noiseGateSlider.addEventListener('input', (e) => {
                    this.elements.noiseGateValue.textContent = e.target.value;
                });
                
                // ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
                this.elements.applySettings.addEventListener('click', () => {
                    this.applySettings();
                });
                
                this.elements.startTest.addEventListener('click', () => {
                    this.startTest();
                });
                
                this.elements.stopTest.addEventListener('click', () => {
                    this.stopTest();
                });
            }
            
            setupLogging() {
                // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£
                const originalLog = console.log;
                const originalWarn = console.warn;
                const originalError = console.error;
                
                console.log = (...args) => {
                    this.addLogEntry('log', args.join(' '));
                    originalLog.apply(console, args);
                };
                
                console.warn = (...args) => {
                    this.addLogEntry('warn', args.join(' '));
                    originalWarn.apply(console, args);
                };
                
                console.error = (...args) => {
                    this.addLogEntry('error', args.join(' '));
                    originalError.apply(console, args);
                };
            }
            
            addLogEntry(level, message) {
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = document.createElement('div');
                logEntry.className = `log-entry log-${level}`;
                logEntry.textContent = `[${timestamp}] ${message}`;
                
                this.elements.logOutput.appendChild(logEntry);
                this.elements.logOutput.scrollTop = this.elements.logOutput.scrollHeight;
                
                // ãƒ­ã‚°ã‚¨ãƒ³ãƒˆãƒªãŒå¤šã™ãã‚‹å ´åˆã¯å¤ã„ã‚‚ã®ã‚’å‰Šé™¤
                const entries = this.elements.logOutput.children;
                if (entries.length > 100) {
                    entries[0].remove();
                }
            }
            
            applySettings() {
                this.currentSettings.sensitivity = parseFloat(this.elements.sensitivitySlider.value);
                this.currentSettings.noiseGateScaling = parseInt(this.elements.noiseGateSlider.value);
                
                this.addLogEntry('info', `Settings Applied - Sensitivity: ${this.currentSettings.sensitivity}, NoiseGate: ${this.currentSettings.noiseGateScaling}`);
                
                // AudioDetectorãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯å†åˆæœŸåŒ–
                if (this.audioDetector) {
                    this.reinitializeDetector();
                }
            }
            
            async reinitializeDetector() {
                this.addLogEntry('info', `Reinitializing with Sensitivity: ${this.currentSettings.sensitivity}, NoiseGate: ${this.currentSettings.noiseGateScaling}`);
                
                // æ—¢å­˜ã®detectorã‚’åœæ­¢ãƒ»ç ´æ£„
                if (this.audioDetector) {
                    this.audioDetector.stopDetection();
                    this.audioDetector.destroy();
                    this.audioDetector = null;
                }
                
                // æ–°ã—ã„è¨­å®šã§åˆæœŸåŒ–
                const success = await this.initializeDetector();
                if (!success) {
                    this.addLogEntry('error', 'Failed to reinitialize detector');
                    return;
                }
                
                // ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œä¸­ã ã£ãŸå ´åˆã¯å†é–‹
                if (this.isRunning) {
                    try {
                        await this.audioDetector.startDetection();
                        this.addLogEntry('info', 'Detection restarted with new settings');
                    } catch (error) {
                        this.addLogEntry('error', `Failed to restart detection: ${error.message}`);
                    }
                }
            }
            
            async initializeDetector() {
                try {
                    this.addLogEntry('info', `ğŸ”§ Initializing detector with: Sensitivity=${this.currentSettings.sensitivity}, NoiseGate=${this.currentSettings.noiseGateScaling}`);
                    
                    // ğŸ” è¨­å®šå€¤ã‚’ã‚ˆã‚Šè©³ç´°ã«ãƒ­ã‚°å‡ºåŠ›
                    const config = {
                        clarityThreshold: 0.4,
                        minVolumeAbsolute: 0.003,
                        deviceOptimization: true, // âœ… ãƒ‡ãƒã‚¤ã‚¹æœ€é©åŒ–ã‚’æœ‰åŠ¹åŒ– (v1.2.0)
                        autoUpdateUI: false,
                        debug: true, // ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°æœ‰åŠ¹åŒ–
                        customDeviceConfig: {
                            sensitivity: this.currentSettings.sensitivity,
                            noiseGateScalingFactor: this.currentSettings.noiseGateScaling
                        }
                    };
                    
                    this.addLogEntry('info', `ğŸ” Config passed to AudioDetectionComponent: ${JSON.stringify(config.customDeviceConfig)}`);
                    
                    // ã‚«ã‚¹ã‚¿ãƒ è¨­å®šã§AudioDetectionComponentã‚’åˆæœŸåŒ–
                    this.audioDetector = new PitchPro.AudioDetectionComponent(config);
                    
                    await this.audioDetector.initialize();
                    
                    // ğŸ” åˆæœŸåŒ–å¾Œã®çŠ¶æ…‹ç¢ºèª
                    const micController = this.audioDetector.microphoneController;
                    if (micController) {
                        this.addLogEntry('info', `ğŸ“± MicrophoneController found`);
                        // AudioDetectionComponentã®å†…éƒ¨çŠ¶æ…‹ã‚’ç¢ºèª
                        const status = this.audioDetector.getStatus();
                        this.addLogEntry('info', `ğŸ“Š AudioDetectionComponent status: ${JSON.stringify({
                            state: status.state,
                            deviceSpecs: status.deviceSpecs,
                            customConfig: status.config.customDeviceConfig
                        })}`);
                    } else {
                        this.addLogEntry('warn', `âš ï¸ MicrophoneController not found`);
                    }
                    
                    // ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­å®š
                    this.audioDetector.setCallbacks({
                        onPitchUpdate: (result) => {
                            this.updateDisplay(result);
                        },
                        onError: (error) => {
                            this.addLogEntry('error', `PitchPro Error: ${error.message}`);
                            this.setStatus('error', `ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                        }
                    });
                    
                    const expectedScaling = Math.round(400 / (this.currentSettings.sensitivity * this.currentSettings.sensitivity));
                    this.addLogEntry('info', `âœ… AudioDetector initialized - Expected SCALING_FACTOR=${expectedScaling}`);
                    return true;
                    
                } catch (error) {
                    this.addLogEntry('error', `âŒ Initialization failed: ${error.message}`);
                    this.setStatus('error', `åˆæœŸåŒ–å¤±æ•—: ${error.message}`);
                    return false;
                }
            }
            
            async startTest() {
                if (!this.audioDetector) {
                    const success = await this.initializeDetector();
                    if (!success) return;
                }
                
                try {
                    await this.audioDetector.startDetection();
                    this.isRunning = true;
                    
                    this.elements.startTest.classList.add('hidden');
                    this.elements.stopTest.classList.remove('hidden');
                    this.setStatus('testing', 'ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­ - ãƒã‚¤ã‚¯ã«å‘ã‹ã£ã¦å£°ã‚’å‡ºã—ã¦ãã ã•ã„');
                    
                    this.addLogEntry('info', 'Volume test started');
                    
                } catch (error) {
                    this.addLogEntry('error', `Test start failed: ${error.message}`);
                    this.setStatus('error', `ãƒ†ã‚¹ãƒˆé–‹å§‹å¤±æ•—: ${error.message}`);
                }
            }
            
            stopTest() {
                if (this.audioDetector) {
                    this.audioDetector.stopDetection();
                }
                
                this.isRunning = false;
                this.elements.startTest.classList.remove('hidden');
                this.elements.stopTest.classList.add('hidden');
                this.setStatus('ready', 'æº–å‚™å®Œäº† - è¨­å®šã‚’èª¿æ•´ã—ã¦ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹');
                
                this.addLogEntry('info', 'Volume test stopped');
            }
            
            updateDisplay(result) {
                // éŸ³é‡è¡¨ç¤º
                if (result.volume !== undefined) {
                    const volume = Math.round(result.volume);
                    this.elements.volumeText.textContent = `${volume}%`;
                    this.elements.volumeBar.style.width = `${Math.min(volume, 100)}%`;
                    
                    // ğŸ” ãƒ‡ãƒãƒƒã‚°ï¼šéŸ³é‡ãŒä½ã„å ´åˆã®è©³ç´°ãƒ­ã‚°
                    if (volume > 0 && volume <= 10) {
                        this.addLogEntry('debug', `âŒ Low volume detected: ${volume}% - Expected higher with sensitivity=${this.currentSettings.sensitivity}`);
                    }
                }
                
                // å‘¨æ³¢æ•°ã¨ãƒãƒ¼ãƒˆ
                if (result.frequency) {
                    this.elements.frequencyValue.textContent = `${Math.round(result.frequency)}Hz`;
                }
                
                if (result.note) {
                    this.elements.noteValue.textContent = result.note;
                }
                
                // SCALING_FACTORè¨ˆç®—è¡¨ç¤º
                if (result.volume !== undefined) {
                    const scalingFactor = Math.round(400 / (this.currentSettings.sensitivity * this.currentSettings.sensitivity));
                    this.elements.scalingFactor.textContent = scalingFactor;
                }
                
                // ğŸ” å¼·åŒ–ã•ã‚ŒãŸãƒ‡ãƒãƒƒã‚°æƒ…å ±ï¼ˆã‚ˆã‚Šé »ç¹ã«å‡ºåŠ›ï¼‰
                if (Math.random() < 0.2 && result.volume > 0) { // 20%ã®ç¢ºç‡ã§ãƒ­ã‚°å‡ºåŠ›ï¼ˆéŸ³é‡ãŒã‚ã‚‹å ´åˆã®ã¿ï¼‰
                    this.addLogEntry('debug', `ğŸ“Š Vol: ${Math.round(result.volume || 0)}%, Freq: ${Math.round(result.frequency || 0)}Hz, SCALING: ${Math.round(400 / (this.currentSettings.sensitivity * this.currentSettings.sensitivity))}, Current Settings: S=${this.currentSettings.sensitivity}, NG=${this.currentSettings.noiseGateScaling}`);
                }
            }
            
            setStatus(type, message) {
                this.elements.status.className = `status status-${type}`;
                this.elements.status.textContent = message;
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            window.mobileTest = new MobileVolumeTest();
        });
        
        // ãƒšãƒ¼ã‚¸é›¢è„±æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        window.addEventListener('beforeunload', () => {
            if (window.mobileTest && window.mobileTest.audioDetector) {
                window.mobileTest.audioDetector.destroy();
            }
        });
    </script>
</body>
</html>