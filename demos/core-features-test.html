<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PitchPro Core Features Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            color: #e5e5e5;
        }
        
        .section {
            background: #2a2a2a;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #3b82f6;
        }
        
        .test-button {
            background: #10b981;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        .test-button:disabled {
            background: #6b7280;
            cursor: not-allowed;
        }
        
        .danger-button {
            background: #ef4444;
        }
        
        .test-results {
            background: #374151;
            border-radius: 5px;
            padding: 15px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .filter-response {
            width: 100%;
            height: 200px;
            background: #1f2937;
            border-radius: 5px;
            margin-top: 10px;
            position: relative;
        }
        
        .error { color: #ef4444; }
        .success { color: #10b981; }
        .warning { color: #f59e0b; }
        .info { color: #3b82f6; }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .status-item {
            background: #374151;
            padding: 10px;
            border-radius: 5px;
            border-left: 3px solid #10b981;
        }
        
        .status-item.error {
            border-left-color: #ef4444;
        }
        
        .status-item.warning {
            border-left-color: #f59e0b;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ PitchPro Core Features Test</h1>
    
    <div class="section">
        <h2>ğŸ”ˆ NoiseFilter Test</h2>
        <p>3æ®µéšãƒã‚¤ã‚ºãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆãƒã‚¤ãƒ‘ã‚¹ãƒ»ãƒ­ãƒ¼ãƒ‘ã‚¹ãƒ»ãƒãƒƒãƒãƒ•ã‚£ãƒ«ã‚¿ï¼‰ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>
        <button class="test-button" onclick="testNoiseFilter()">ãƒ•ã‚£ãƒ«ã‚¿ãƒ†ã‚¹ãƒˆé–‹å§‹</button>
        <button class="test-button" onclick="testFilterPresets()">ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" onclick="testFilterResponse()">å‘¨æ³¢æ•°å¿œç­”ãƒ†ã‚¹ãƒˆ</button>
        <div id="noise-filter-results" class="test-results"></div>
        <canvas id="filter-response-canvas" class="filter-response" style="display:none;"></canvas>
    </div>
    
    <div class="section">
        <h2>ğŸ¤ MicrophoneController Test</h2>
        <p>é«˜ãƒ¬ãƒ™ãƒ«ãƒã‚¤ã‚¯ç®¡ç†ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>
        <button class="test-button" onclick="testMicrophoneController()">ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" onclick="testMicrophonePermissions()">æ¨©é™ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" onclick="testMicrophoneTest()">ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <button class="test-button danger-button" onclick="stopMicrophone()">ãƒã‚¤ã‚¯åœæ­¢</button>
        <div id="microphone-results" class="test-results"></div>
        <div id="microphone-status" class="status-grid"></div>
    </div>
    
    <div class="section">
        <h2>ğŸ”„ MicrophoneLifecycleManager Test</h2>
        <p>ãƒã‚¤ã‚¯ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†ã¨ãƒªã‚½ãƒ¼ã‚¹å‚ç…§ã‚«ã‚¦ãƒ³ãƒ†ã‚£ãƒ³ã‚°ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>
        <button class="test-button" onclick="testLifecycleManager()">ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" onclick="testReferenceCount()">å‚ç…§ã‚«ã‚¦ãƒ³ã‚¿ãƒ†ã‚¹ãƒˆ</button>
        <div id="lifecycle-results" class="test-results"></div>
    </div>
    
    <div class="section">
        <h2>âš ï¸ ErrorNotificationSystem Test</h2>
        <p>ã‚¨ãƒ©ãƒ¼é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>
        <button class="test-button" onclick="testErrorSystem()">ã‚¨ãƒ©ãƒ¼é€šçŸ¥ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" onclick="testDifferentNotifications()">å„ç¨®é€šçŸ¥ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button danger-button" onclick="clearNotifications()">é€šçŸ¥ã‚¯ãƒªã‚¢</button>
        <div id="error-system-results" class="test-results"></div>
    </div>

    <script src="../dist-umd/pitchpro.umd.js"></script>
    <script>
        let globalMicController = null;
        let globalLifecycleManager = null;
        let globalErrorSystem = null;

        let log = (elementId, message, type = 'info') => {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : type === 'info' ? 'info' : '';
            element.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            element.scrollTop = element.scrollHeight;
        };

        // NoiseFilter Test
        async function testNoiseFilter() {
            const resultId = 'noise-filter-results';
            document.getElementById(resultId).innerHTML = '';
            
            try {
                log(resultId, 'ğŸ”ˆ NoiseFilter ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
                
                // AudioContextã‚’ä½œæˆï¼ˆå®Ÿéš›ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ†ã‚¹ãƒˆç”¨ï¼‰
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                await audioContext.resume();
                
                log(resultId, `âœ… AudioContextä½œæˆå®Œäº† (sampleRate: ${audioContext.sampleRate})`, 'success');
                
                // NoiseFilterã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
                const noiseFilter = new PitchPro.NoiseFilter(audioContext, {
                    highpassFreq: 80,
                    lowpassFreq: 800,
                    notchFreq: 60,
                    useFilters: true
                });
                
                log(resultId, 'âœ… NoiseFilter ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆæˆåŠŸ', 'success');
                
                // è¨­å®šç¢ºèª
                const config = noiseFilter.getConfig();
                log(resultId, `è¨­å®š: ${JSON.stringify(config)}`, 'info');
                
                // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
                const status = noiseFilter.getStatus();
                log(resultId, `ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${JSON.stringify(status)}`, 'info');
                
                // ãƒ•ã‚£ãƒ«ã‚¿ã®æœ‰åŠ¹/ç„¡åŠ¹ãƒ†ã‚¹ãƒˆ
                log(resultId, 'ãƒ•ã‚£ãƒ«ã‚¿ç„¡åŠ¹åŒ–ãƒ†ã‚¹ãƒˆ...', 'info');
                noiseFilter.setEnabled(false);
                const disabledStatus = noiseFilter.getStatus();
                log(resultId, `ç„¡åŠ¹åŒ–å¾Œ: useFilters=${disabledStatus.useFilters}`, disabledStatus.useFilters ? 'error' : 'success');
                
                noiseFilter.setEnabled(true);
                const enabledStatus = noiseFilter.getStatus();
                log(resultId, `æœ‰åŠ¹åŒ–å¾Œ: useFilters=${enabledStatus.useFilters}`, enabledStatus.useFilters ? 'success' : 'error');
                
                // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ›´æ–°ãƒ†ã‚¹ãƒˆ
                log(resultId, 'ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ›´æ–°ãƒ†ã‚¹ãƒˆ...', 'info');
                noiseFilter.updateFrequencies({
                    highpassFreq: 100,
                    lowpassFreq: 700,
                    notchFreq: 50
                });
                
                const updatedConfig = noiseFilter.getConfig();
                log(resultId, `æ›´æ–°å¾Œã®è¨­å®š: highpass=${updatedConfig.highpassFreq}Hz, lowpass=${updatedConfig.lowpassFreq}Hz, notch=${updatedConfig.notchFreq}Hz`, 'success');
                
                // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                noiseFilter.destroy();
                audioContext.close();
                
                log(resultId, 'âœ… NoiseFilter ãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
                
            } catch (error) {
                log(resultId, `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                console.error('NoiseFilter test error:', error);
            }
        }
        
        async function testFilterPresets() {
            const resultId = 'noise-filter-results';
            
            try {
                log(resultId, 'ğŸ›ï¸ ãƒ•ã‚£ãƒ«ã‚¿ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
                
                const presets = ['voice', 'instrument', 'wide', 'minimal'];
                
                for (const preset of presets) {
                    const config = PitchPro.NoiseFilter.getPresetConfig(preset);
                    log(resultId, `${preset}ãƒ—ãƒªã‚»ãƒƒãƒˆ: ${JSON.stringify(config)}`, 'info');
                }
                
                log(resultId, 'âœ… ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
                
            } catch (error) {
                log(resultId, `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        async function testFilterResponse() {
            const resultId = 'noise-filter-results';
            
            try {
                log(resultId, 'ğŸ“Š å‘¨æ³¢æ•°å¿œç­”ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
                
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                await audioContext.resume();
                
                const noiseFilter = new PitchPro.NoiseFilter(audioContext);
                
                // ãƒ†ã‚¹ãƒˆå‘¨æ³¢æ•°ã§ã®å¿œç­”ã‚’ç¢ºèª
                const testFrequencies = [50, 80, 100, 200, 440, 800, 1000, 2000];
                
                for (const freq of testFrequencies) {
                    const response = noiseFilter.getFilterResponse(freq);
                    log(resultId, `${freq}Hz: magnitude=${response.magnitude.toFixed(3)}, phase=${response.phase.toFixed(3)}`, 'info');
                }
                
                noiseFilter.destroy();
                audioContext.close();
                
                log(resultId, 'âœ… å‘¨æ³¢æ•°å¿œç­”ãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
                
            } catch (error) {
                log(resultId, `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // MicrophoneController Test
        async function testMicrophoneController() {
            const resultId = 'microphone-results';
            document.getElementById(resultId).innerHTML = '';
            
            try {
                log(resultId, 'ğŸ¤ MicrophoneController ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
                
                // ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
                globalMicController = new PitchPro.MicrophoneController({}, {}, true);
                
                log(resultId, 'âœ… MicrophoneController ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆæˆåŠŸ', 'success');
                
                // ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­å®š
                globalMicController.setCallbacks({
                    onStateChange: (state) => {
                        log(resultId, `çŠ¶æ…‹å¤‰æ›´: ${state}`, 'info');
                        updateMicrophoneStatus();
                    },
                    onError: (error) => {
                        log(resultId, `ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                    },
                    onPermissionChange: (granted) => {
                        log(resultId, `æ¨©é™å¤‰æ›´: ${granted ? 'è¨±å¯' : 'æ‹’å¦'}`, granted ? 'success' : 'error');
                    },
                    onDeviceChange: (specs) => {
                        log(resultId, `ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡º: ${specs.deviceType} (æ„Ÿåº¦: ${specs.sensitivity})`, 'info');
                    }
                });
                
                // ãƒ‡ãƒã‚¤ã‚¹ã‚¹ãƒšãƒƒã‚¯å–å¾—
                const deviceSpecs = globalMicController.getDeviceSpecs();
                if (deviceSpecs) {
                    log(resultId, `ãƒ‡ãƒã‚¤ã‚¹: ${deviceSpecs.deviceType}, æ„Ÿåº¦: ${deviceSpecs.sensitivity}`, 'info');
                }
                
                // åˆæœŸçŠ¶æ…‹ç¢ºèª
                updateMicrophoneStatus();
                
                log(resultId, 'âœ… MicrophoneController ãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
                
            } catch (error) {
                log(resultId, `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                console.error('MicrophoneController test error:', error);
            }
        }
        
        async function testMicrophonePermissions() {
            const resultId = 'microphone-results';
            
            if (!globalMicController) {
                log(resultId, 'âš ï¸ å…ˆã«MicrophoneControllerãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„', 'warning');
                return;
            }
            
            try {
                log(resultId, 'ğŸ” æ¨©é™ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
                
                // æ¨©é™çŠ¶æ…‹ç¢ºèª
                const permissionStatus = await globalMicController.checkPermissionStatus();
                log(resultId, `ç¾åœ¨ã®æ¨©é™çŠ¶æ…‹: ${permissionStatus}`, 'info');
                
                // æ¨©é™è¦æ±‚
                log(resultId, 'æ¨©é™è¦æ±‚ä¸­...', 'info');
                const granted = await globalMicController.requestPermission();
                log(resultId, `æ¨©é™è¦æ±‚çµæœ: ${granted ? 'æˆåŠŸ' : 'å¤±æ•—'}`, granted ? 'success' : 'error');
                
                updateMicrophoneStatus();
                
            } catch (error) {
                log(resultId, `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        async function testMicrophoneTest() {
            const resultId = 'microphone-results';
            
            if (!globalMicController) {
                log(resultId, 'âš ï¸ å…ˆã«MicrophoneControllerãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„', 'warning');
                return;
            }
            
            try {
                log(resultId, 'ğŸ§ª ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­... (3ç§’é–“)', 'info');
                
                const testResult = await globalMicController.testMicrophone(3000);
                
                log(resultId, `ãƒ†ã‚¹ãƒˆçµæœ:`, 'info');
                log(resultId, `  æˆåŠŸ: ${testResult.success}`, testResult.success ? 'success' : 'error');
                log(resultId, `  æœ€å¤§éŸ³é‡: ${testResult.volume.toFixed(2)}`, 'info');
                log(resultId, `  æ¤œå‡ºå‘¨æ³¢æ•°: ${testResult.frequency ? testResult.frequency.toFixed(0) + 'Hz' : 'ãªã—'}`, 'info');
                log(resultId, `  å®Ÿè¡Œæ™‚é–“: ${testResult.duration}ms`, 'info');
                
                if (testResult.error) {
                    log(resultId, `  ã‚¨ãƒ©ãƒ¼: ${testResult.error.message}`, 'error');
                }
                
            } catch (error) {
                log(resultId, `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        function stopMicrophone() {
            const resultId = 'microphone-results';
            
            if (!globalMicController) {
                log(resultId, 'âš ï¸ åœæ­¢ã™ã‚‹ãƒã‚¤ã‚¯ãŒã‚ã‚Šã¾ã›ã‚“', 'warning');
                return;
            }
            
            log(resultId, 'ğŸ›‘ ãƒã‚¤ã‚¯åœæ­¢ä¸­...', 'info');
            globalMicController.stop();
            log(resultId, 'âœ… ãƒã‚¤ã‚¯åœæ­¢å®Œäº†', 'success');
            
            updateMicrophoneStatus();
        }
        
        function updateMicrophoneStatus() {
            const statusContainer = document.getElementById('microphone-status');
            
            if (!globalMicController) {
                statusContainer.innerHTML = '<div class="status-item error">MicrophoneControlleræœªåˆæœŸåŒ–</div>';
                return;
            }
            
            const status = globalMicController.getStatus();
            
            const statusItems = [
                { label: 'çŠ¶æ…‹', value: status.state, type: status.state === 'error' ? 'error' : status.state === 'active' ? 'success' : 'info' },
                { label: 'æ¨©é™', value: status.isPermissionGranted ? 'è¨±å¯æ¸ˆã¿' : 'æœªè¨±å¯', type: status.isPermissionGranted ? 'success' : 'error' },
                { label: 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–', value: status.isActive ? 'ã¯ã„' : 'ã„ã„ãˆ', type: status.isActive ? 'success' : 'info' },
                { label: 'æº–å‚™å®Œäº†', value: status.isReady ? 'ã¯ã„' : 'ã„ã„ãˆ', type: status.isReady ? 'success' : 'info' },
                { label: 'æ„Ÿåº¦', value: status.sensitivity + 'x', type: 'info' },
                { label: 'ãƒ‡ãƒã‚¤ã‚¹', value: status.deviceSpecs?.deviceType || 'ãªã—', type: 'info' }
            ];
            
            statusContainer.innerHTML = statusItems.map(item => 
                `<div class="status-item ${item.type}">
                    <strong>${item.label}:</strong> ${item.value}
                </div>`
            ).join('');
        }

        // LifecycleManager Test
        async function testLifecycleManager() {
            const resultId = 'lifecycle-results';
            document.getElementById(resultId).innerHTML = '';
            
            try {
                log(resultId, 'ğŸ”„ MicrophoneLifecycleManager ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
                
                // AudioManagerãŒå¿…è¦
                const audioManager = new PitchPro.AudioManager();
                globalLifecycleManager = new PitchPro.MicrophoneLifecycleManager(audioManager);
                
                log(resultId, 'âœ… LifecycleManager ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆæˆåŠŸ', 'success');
                
                // ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­å®š
                globalLifecycleManager.setCallbacks({
                    onStateChange: (state) => {
                        log(resultId, `çŠ¶æ…‹å¤‰æ›´: ${state}`, 'info');
                    },
                    onError: (error) => {
                        log(resultId, `ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                    }
                });
                
                // åˆæœŸçŠ¶æ…‹ç¢ºèª
                const initialStatus = globalLifecycleManager.getStatus();
                log(resultId, `åˆæœŸçŠ¶æ…‹: ${JSON.stringify(initialStatus)}`, 'info');
                
                log(resultId, 'âœ… LifecycleManager ãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
                
            } catch (error) {
                log(resultId, `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                console.error('LifecycleManager test error:', error);
            }
        }
        
        async function testReferenceCount() {
            const resultId = 'lifecycle-results';
            
            if (!globalLifecycleManager) {
                log(resultId, 'âš ï¸ å…ˆã«LifecycleManagerãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„', 'warning');
                return;
            }
            
            try {
                log(resultId, 'ğŸ”¢ å‚ç…§ã‚«ã‚¦ãƒ³ã‚¿ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
                
                // è¤‡æ•°å›å–å¾—
                log(resultId, 'ãƒªã‚½ãƒ¼ã‚¹å–å¾— 1å›ç›®...', 'info');
                try {
                    await globalLifecycleManager.acquire();
                    log(resultId, 'âœ… 1å›ç›®æˆåŠŸ', 'success');
                } catch (error) {
                    log(resultId, `âŒ 1å›ç›®å¤±æ•—: ${error.message}`, 'error');
                }
                
                log(resultId, 'ãƒªã‚½ãƒ¼ã‚¹å–å¾— 2å›ç›®...', 'info');
                try {
                    await globalLifecycleManager.acquire();
                    log(resultId, 'âœ… 2å›ç›®æˆåŠŸ', 'success');
                } catch (error) {
                    log(resultId, `âŒ 2å›ç›®å¤±æ•—: ${error.message}`, 'error');
                }
                
                // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
                const status = globalLifecycleManager.getStatus();
                log(resultId, `ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${JSON.stringify(status)}`, 'info');
                
                // è§£æ”¾ãƒ†ã‚¹ãƒˆ
                log(resultId, 'ãƒªã‚½ãƒ¼ã‚¹è§£æ”¾ 1å›ç›®...', 'info');
                globalLifecycleManager.release();
                log(resultId, 'âœ… 1å›ç›®è§£æ”¾å®Œäº†', 'success');
                
                log(resultId, 'ãƒªã‚½ãƒ¼ã‚¹è§£æ”¾ 2å›ç›®...', 'info');
                globalLifecycleManager.release();
                log(resultId, 'âœ… 2å›ç›®è§£æ”¾å®Œäº†', 'success');
                
                const finalStatus = globalLifecycleManager.getStatus();
                log(resultId, `æœ€çµ‚ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${JSON.stringify(finalStatus)}`, 'info');
                
            } catch (error) {
                log(resultId, `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ErrorNotificationSystem Test
        function testErrorSystem() {
            const resultId = 'error-system-results';
            document.getElementById(resultId).innerHTML = '';
            
            try {
                log(resultId, 'âš ï¸ ErrorNotificationSystem ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
                
                globalErrorSystem = new PitchPro.ErrorNotificationSystem();
                log(resultId, 'âœ… ErrorNotificationSystem ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆæˆåŠŸ', 'success');
                
                // åŸºæœ¬ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
                globalErrorSystem.showError(
                    'ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼',
                    'ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆç”¨ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã™ã€‚',
                    { priority: 'medium', autoHide: true, duration: 3000 }
                );
                
                log(resultId, 'ğŸ“¢ ã‚¨ãƒ©ãƒ¼é€šçŸ¥ã‚’è¡¨ç¤ºã—ã¾ã—ãŸï¼ˆ3ç§’å¾Œã«è‡ªå‹•æ¶ˆå»ï¼‰', 'success');
                
                // ãƒã‚¤ã‚¯ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
                setTimeout(() => {
                    const micError = new Error('ãƒã‚¤ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼');
                    globalErrorSystem.showMicrophoneError(micError, 'test');
                    log(resultId, 'ğŸ“¢ ãƒã‚¤ã‚¯ã‚¨ãƒ©ãƒ¼é€šçŸ¥ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ', 'success');
                }, 1000);
                
                log(resultId, 'âœ… ErrorSystem ãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
                
            } catch (error) {
                log(resultId, `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                console.error('ErrorSystem test error:', error);
            }
        }
        
        function testDifferentNotifications() {
            const resultId = 'error-system-results';
            
            if (!globalErrorSystem) {
                log(resultId, 'âš ï¸ å…ˆã«ErrorSystemãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„', 'warning');
                return;
            }
            
            const notifications = [
                { type: 'success', title: 'æˆåŠŸ', message: 'æ“ä½œãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ', priority: 'low' },
                { type: 'warning', title: 'è­¦å‘Š', message: 'æ³¨æ„ãŒå¿…è¦ãªçŠ¶æ³ã§ã™', priority: 'medium' },
                { type: 'error', title: 'ã‚¨ãƒ©ãƒ¼', message: 'é‡å¤§ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', priority: 'high' },
                { type: 'info', title: 'æƒ…å ±', message: 'è¿½åŠ ã®æƒ…å ±ã‚’ãŠçŸ¥ã‚‰ã›ã—ã¾ã™', priority: 'low' }
            ];
            
            notifications.forEach((notif, index) => {
                setTimeout(() => {
                    globalErrorSystem.showNotification({
                        type: notif.type,
                        title: notif.title,
                        message: notif.message,
                        priority: notif.priority,
                        autoHide: true,
                        duration: 4000
                    });
                    log(resultId, `ğŸ“¢ ${notif.type}é€šçŸ¥ã‚’è¡¨ç¤º`, 'info');
                }, index * 500);
            });
        }
        
        function clearNotifications() {
            const resultId = 'error-system-results';
            
            if (!globalErrorSystem) {
                log(resultId, 'âš ï¸ ErrorSystemãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“', 'warning');
                return;
            }
            
            globalErrorSystem.clearAll();
            log(resultId, 'ğŸ—‘ï¸ å…¨ã¦ã®é€šçŸ¥ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'success');
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('PitchPro Core Features Test loaded');
            
            // ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
            if (typeof PitchPro === 'undefined') {
                document.body.innerHTML = '<h1 style="color: red;">âŒ PitchProãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“</h1>';
                return;
            }
            
            // åˆ©ç”¨å¯èƒ½ãªCoreæ©Ÿèƒ½ã‚’ç¢ºèª
            const availableFeatures = {
                NoiseFilter: !!PitchPro.NoiseFilter,
                MicrophoneController: !!PitchPro.MicrophoneController,
                MicrophoneLifecycleManager: !!PitchPro.MicrophoneLifecycleManager,
                ErrorNotificationSystem: !!PitchPro.ErrorNotificationSystem
            };
            
            console.log('åˆ©ç”¨å¯èƒ½ãªCoreæ©Ÿèƒ½:', availableFeatures);
        });
        
        // ãƒšãƒ¼ã‚¸é›¢è„±æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        window.addEventListener('beforeunload', () => {
            if (globalMicController) {
                globalMicController.destroy();
            }
            if (globalLifecycleManager) {
                globalLifecycleManager.destroy();
            }
            if (globalErrorSystem) {
                globalErrorSystem.destroy();
            }
        });
    </script>
</body>
</html>