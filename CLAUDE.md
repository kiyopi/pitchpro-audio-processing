# PitchPro Audio Processing - Claude Code ã‚¬ã‚¤ãƒ‰

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
PitchPro Audio Processingã¯ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³éŸ¿å‡¦ç†ã¨ãƒ”ãƒƒãƒæ¤œå‡ºã«ç‰¹åŒ–ã—ãŸTypeScriptãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚McLeod Pitch Methodã‚’ä½¿ç”¨ã—ã€iPhone/Android/PCå‘ã‘ã«æœ€é©åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚

## ç¾åœ¨ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³
**v1.1.0** - 2025å¹´9æœˆ7æ—¥ãƒªãƒªãƒ¼ã‚¹

## ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### ã‚³ã‚¢ã‚·ã‚¹ãƒ†ãƒ 
- `PitchDetector`: ãƒ¡ã‚¤ãƒ³ã®ãƒ”ãƒƒãƒæ¤œå‡ºã‚¨ãƒ³ã‚¸ãƒ³
- `AudioManager`: AudioContextç®¡ç†ã¨ãƒªã‚½ãƒ¼ã‚¹åˆ¶å¾¡
- `DeviceDetection`: ãƒ‡ãƒã‚¤ã‚¹å›ºæœ‰ã®æœ€é©åŒ–è¨­å®š

### ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
- `AdaptiveFrameRateLimiter`: é©å¿œãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆåˆ¶å¾¡
- `PerformanceMonitor`: CircularBufferã«ã‚ˆã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ç›£è¦–
- æ§‹é€ åŒ–ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ 

## æ”¹å–„å®Œäº†é …ç›®ï¼ˆv1.1.0ï¼‰

### âœ… ãƒ¡ãƒ¢ãƒªæœ€é©åŒ–
- CircularBufferã«ã‚ˆã‚‹O(1)ãƒ¡ãƒ¢ãƒªæ“ä½œ
- ç„¡åˆ¶é™é…åˆ—å¢—å¤§ã®é˜²æ­¢
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™ã®åŠ¹ç‡çš„ãªä¿å­˜

### âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š
- çµ¶å¯¾æ™‚åˆ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã«ã‚ˆã‚‹ç´¯ç©èª¤å·®é˜²æ­¢
- é©å¿œFPSåˆ¶å¾¡ï¼ˆ30-60FPSï¼‰
- ãƒ‡ãƒã‚¤ã‚¹åˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°çµ±åˆ
- PitchProErroråŸºåº•ã‚¯ãƒ©ã‚¹
- AudioContextError, PitchDetectionError
- å›å¾©å¯èƒ½ã‚¨ãƒ©ãƒ¼ã®è‡ªå‹•åˆ†é¡

### âœ… åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ
- ãƒ‡ãƒã‚¤ã‚¹å›ºæœ‰ãƒ†ã‚¹ãƒˆï¼ˆiPhone/Android/Desktopï¼‰
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ‰ãƒ­ãƒƒãƒ—ã€çœé›»åŠ›ï¼‰
- å®Ÿä¸–ç•Œã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆ

## æ¬¡æœŸèª²é¡Œï¼ˆv1.2.0å¯¾å¿œäºˆå®šï¼‰

### ğŸ”´ é«˜å„ªå…ˆåº¦èª²é¡Œ

#### 1. çµ±åˆãƒ†ã‚¹ãƒˆå†æœ‰åŠ¹åŒ–
**ç¾åœ¨ã®çŠ¶æ³**: çµ±åˆãƒ†ã‚¹ãƒˆãŒCIã§ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹
```typescript
// ç¾åœ¨ã®å•é¡Œã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰
describe.skip('Integration Tests', () => {
```

**è§£æ±ºã™ã¹ãèª²é¡Œ**:
- AudioManager + PitchDetectoré€£æºãƒ†ã‚¹ãƒˆã®å®‰å®šåŒ–
- é©åˆ‡ãªãƒ¢ãƒƒã‚¯æˆ¦ç•¥ã®å®Ÿè£…
- CIç’°å¢ƒã§ã®å®‰å®šã—ãŸãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

**æœŸå¾…ã•ã‚Œã‚‹æˆæœç‰©**:
```typescript
// æœŸå¾…ã•ã‚Œã‚‹è§£æ±ºå¾Œã®ã‚³ãƒ¼ãƒ‰
describe('Integration Tests', () => {
  // é©åˆ‡ãªãƒ¢ãƒƒã‚¯å®Ÿè£…
  beforeEach(() => {
    // å®‰å®šã—ãŸãƒ¢ãƒƒã‚¯è¨­å®š
  });
});
```

#### 2. ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼å®šæ•°åŒ–
**ç¾åœ¨ã®å•é¡Œ**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ¶å¾¡ã§ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸå€¤
```typescript
// å•é¡Œã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰
if (this.frameDrops > 5 && this.targetFPS > this.MIN_FPS) {
  this.targetFPS = Math.max(this.MIN_FPS, this.targetFPS - 5);
}
```

**è§£æ±ºç­–**:
```typescript
// æœŸå¾…ã•ã‚Œã‚‹è§£æ±ºå¾Œã®ã‚³ãƒ¼ãƒ‰
private static readonly FRAME_DROP_THRESHOLD = 5;
private static readonly FPS_ADJUSTMENT_STEP = 5;
private static readonly PERFORMANCE_CHECK_INTERVAL = 10;

if (this.frameDrops > this.FRAME_DROP_THRESHOLD && this.targetFPS > this.MIN_FPS) {
  this.targetFPS = Math.max(this.MIN_FPS, this.targetFPS - this.FPS_ADJUSTMENT_STEP);
}
```

#### 3. ç’°å¢ƒåˆ¥ãƒ†ã‚¹ãƒˆé–¾å€¤è¨­å®š
**ç¾åœ¨ã®å•é¡Œ**: CIç’°å¢ƒã§ãƒ†ã‚¹ãƒˆå¤±æ•—ã‚’é¿ã‘ã‚‹ãŸã‚è¨±å®¹å€¤ã‚’ç·©å’Œ
```typescript
// å•é¡Œã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰
expect(Math.abs(cents)).toBeLessThan(50); // 20â†’50ã«ç·©å’Œ
```

**è§£æ±ºç­–**:
```typescript
// æœŸå¾…ã•ã‚Œã‚‹è§£æ±ºå¾Œã®ã‚³ãƒ¼ãƒ‰
interface TestConfig {
  pitchToleranceCents: number;
  performanceToleranceMs: number;
  noiseTestTolerance: number;
}

const TEST_CONFIG: TestConfig = {
  pitchToleranceCents: process.env.CI ? 30 : 20,
  performanceToleranceMs: process.env.CI ? 50 : 35,
  noiseTestTolerance: process.env.CI ? 40 : 25
};

expect(Math.abs(cents)).toBeLessThan(TEST_CONFIG.pitchToleranceCents);
```

### ğŸŸ¡ ä¸­å„ªå…ˆåº¦èª²é¡Œ

#### 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- `CircularBuffer.toArray()`ã®é…å»¶è©•ä¾¡å®Ÿè£…
- `performance.now()`å‘¼ã³å‡ºã—ã®ãƒãƒƒãƒåŒ–
- å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆå¯¾å¿œã®æœ€é©åŒ–

#### 5. ãƒ‡ãƒãƒƒã‚°ã‚·ã‚¹ãƒ†ãƒ å¼·åŒ–
```typescript
// å®Ÿè£…äºˆå®šã®ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ 
enum LogLevel {
  DEBUG = 0,
  INFO = 1,
  WARN = 2,
  ERROR = 3
}

class Logger {
  constructor(private level: LogLevel) {}
  
  debug(message: string, context?: any) {
    if (this.level <= LogLevel.DEBUG) {
      console.debug(`[DEBUG] ${message}`, context);
    }
  }
}
```

#### 6. ã‚¨ãƒ©ãƒ¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ‹¡å……
- ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±ã®è©³ç´°åŒ–
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çŠ¶æ…‹ã®è¨ºæ–­æƒ…å ±è¿½åŠ 
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å±¥æ­´ã®è¨˜éŒ²

### ğŸŸ¢ ä½å„ªå…ˆåº¦èª²é¡Œ

#### 7. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™
- JSDoc APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå®Œå‚™
- ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³ã®ä½œæˆ
- ä½¿ç”¨ä¾‹ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

#### 8. ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ é€£æº
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™ã®å¤–éƒ¨å‡ºåŠ›
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å¯¾å¿œ
- ã‚¢ãƒ©ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ é€£æº

## Claude Codeä½¿ç”¨æ™‚ã®æ¨å¥¨äº‹é …

### é–‹ç™ºãƒ•ãƒ­ãƒ¼
1. èª²é¡Œç¢ºèª: `CODE_REVIEW_V1.1.0.md`ã§å„ªå…ˆåº¦ç¢ºèª
2. å®Ÿè£…å‰: æ—¢å­˜ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ (`npm test`)
3. å®Ÿè£…: TypeScript strict modeæº–æ‹ 
4. ãƒ†ã‚¹ãƒˆ: ãƒ‡ãƒã‚¤ã‚¹å›ºæœ‰ãƒ†ã‚¹ãƒˆè¿½åŠ 
5. æ¤œè¨¼: å®Ÿæ©Ÿãƒ†ã‚¹ãƒˆï¼ˆPC/iPhone/iPadï¼‰

### ãƒ†ã‚¹ãƒˆæˆ¦ç•¥
```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm test

# å€‹åˆ¥ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm test test/PitchDetector.test.ts
npm test test/performance.test.ts
npm test test/device-performance.test.ts

# CIå¯¾å¿œãƒ†ã‚¹ãƒˆ
npm test -- --run
```

### ãƒ“ãƒ«ãƒ‰ã¨ãƒ‡ãƒ—ãƒ­ã‚¤
```bash
# å‹ãƒã‚§ãƒƒã‚¯
npm run typecheck

# ãƒ“ãƒ«ãƒ‰
npm run build

# ãƒ‡ãƒ—ãƒ­ã‚¤å‰ç¢ºèª
npm run build && npm test -- --run
```

## é‡è¦ãªå®Ÿè£…åŸå‰‡

### ãƒ¡ãƒ¢ãƒªåŠ¹ç‡
- å¿…ãšCircularBufferã‚’ä½¿ç”¨ã—ã¦ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã‚’é˜²æ­¢
- å¤§ããªé…åˆ—æ“ä½œã¯é…å»¶è©•ä¾¡ã‚’æ¤œè¨
- WeakMapã‚’é©åˆ‡ã«ä½¿ç”¨ã—ã¦ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä¿ƒé€²

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆåˆ¶å¾¡ã¯å¿…é ˆï¼ˆ30-60FPSç¯„å›²ï¼‰
- ãƒ‡ãƒã‚¤ã‚¹å›ºæœ‰ã®æœ€é©åŒ–ã‚’å¿˜ã‚Œãšã«å®Ÿè£…
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™ã®ç¶™ç¶šçš„ãªç›£è¦–

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- å¿…ãšæ§‹é€ åŒ–ã‚¨ãƒ©ãƒ¼ï¼ˆPitchProErrorç³»ï¼‰ã‚’ä½¿ç”¨
- å›å¾©å¯èƒ½ã‚¨ãƒ©ãƒ¼ã¨è‡´å‘½çš„ã‚¨ãƒ©ãƒ¼ã‚’é©åˆ‡ã«åˆ†é¡
- ã‚¨ãƒ©ãƒ¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«è¨ºæ–­æƒ…å ±ã‚’å«ã‚ã‚‹

### ãƒ†ã‚¹ãƒˆ
- ãƒ‡ãƒã‚¤ã‚¹å›ºæœ‰ãƒ†ã‚¹ãƒˆã‚’å¿…ãšè¿½åŠ 
- CIç’°å¢ƒã¨é–‹ç™ºç’°å¢ƒã®å·®ã‚’è€ƒæ…®
- çµ±åˆãƒ†ã‚¹ãƒˆã¯é©åˆ‡ãªãƒ¢ãƒƒã‚¯æˆ¦ç•¥ã§å®Ÿè£…

## æ¬¡ã®ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³

**v1.2.0 ãƒªãƒªãƒ¼ã‚¹äºˆå®š**: 2025å¹´10æœˆ  
**ä¸»è¦ç›®æ¨™**: é«˜å„ªå…ˆåº¦èª²é¡Œã®è§£æ±ºã¨ã‚·ã‚¹ãƒ†ãƒ å®‰å®šæ€§å‘ä¸Š

ã“ã®ã‚¬ã‚¤ãƒ‰ã«åŸºã¥ã„ã¦ã€ç¶™ç¶šçš„ãªæ”¹å–„ã¨é«˜å“è³ªãªã‚³ãƒ¼ãƒ‰ã®ç¶­æŒã‚’ç›®æŒ‡ã—ã¦ãã ã•ã„ã€‚