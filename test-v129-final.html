<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ PitchPro v1.2.9 + çµ±ä¸€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ + PC=0.9%ãƒã‚¤ã‚ºã‚²ãƒ¼ãƒˆ</title>

    <!-- å®Œå…¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥å›é¿è¨­å®š -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <style>
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            margin: 0;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #4CAF50;
            border-radius: 8px;
        }

        .test-section {
            background: #333;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }

        .config-display {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 2px solid #FFD700;
        }

        .value-highlight {
            background: #FFD700;
            color: #000;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
            font-size: 14px;
        }

        .success { color: #4CAF50; }
        .error { color: #F44336; }
        .warning { color: #FF9800; }

        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }

        button:hover {
            background: #45a049;
        }

        .log-entry {
            font-family: 'Courier New', monospace;
            font-size: 11px;
            margin: 3px 0;
            padding: 3px 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤ PitchPro v1.2.9 + ãƒãƒ©ãƒ³ã‚¹æœ€é©åŒ–</h1>
            <p>ğŸ¯ sensitivity=1.7 + noiseGate=1.8% ã§ãƒãƒ©ãƒ³ã‚¹èª¿æ•´</p>
        </div>

        <div class="test-section">
            <h2>ğŸ¯ v1.2.9+ ãƒãƒ©ãƒ³ã‚¹æœ€é©åŒ–è¨­å®š</h2>
            <div class="config-display">
                <div><strong>PC sensitivity:</strong> <span class="value-highlight">1.7</span> (2.5â†’1.7ã§ãƒãƒ©ãƒ³ã‚¹èª¿æ•´)</div>
                <div><strong>PC noiseGate:</strong> <span class="value-highlight">0.018</span> (1.8%)</div>
                <div><strong>æœŸå¾…åŠ¹æœ:</strong> <span class="value-highlight">ãƒã‚¤ã‚ºãƒ–ãƒ­ãƒƒã‚¯ + éŸ³é‡ãƒãƒ©ãƒ³ã‚¹æœ€é©åŒ–</span></div>
                <div><strong>ç›®æ¨™:</strong> æ™®é€šã®å£°ã§15-25%ã€å¸¸æ™‚ãƒã‚¤ã‚ºã‚’ãƒ–ãƒ­ãƒƒã‚¯</div>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ“Š å®Ÿéš›ã®è¨­å®šå€¤ç¢ºèª</h2>
            <div id="actualConfig" class="config-display">
                <div id="configStatus">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰...</div>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</h2>
            <button id="startBtn" onclick="runConfigTest()">è¨­å®šå€¤æ¤œè¨¼ãƒ†ã‚¹ãƒˆé–‹å§‹</button>
            <button id="stopBtn" onclick="stopTest()" disabled>ãƒ†ã‚¹ãƒˆåœæ­¢</button>
            <button onclick="clearLogs()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
            <button onclick="exportLogs()">ãƒ­ã‚°ã‚’ã‚³ãƒ”ãƒ¼</button>
            <button onclick="forceHardReload()" style="background: #FF5722;">ğŸš€ HARD RELOAD</button>
        </div>

        <div class="test-section">
            <h2>ğŸ“‹ ãƒ†ã‚¹ãƒˆãƒ­ã‚°</h2>
            <div id="testLogs" style="max-height: 400px; overflow-y: auto;">
                <!-- ãƒ­ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
            </div>
        </div>
    </div>

    <script>
        // å®Œå…¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥å›é¿ã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿
        const timestamp = Date.now();
        const randomId = Math.random().toString(36).substring(2);
        const script = document.createElement('script');

        // ğŸš€ NUCLEAR ã‚­ãƒ£ãƒƒã‚·ãƒ¥å®Œå…¨å›é¿ - ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ãƒãƒƒã‚·ãƒ¥ + ä¹±æ•°å®Œå…¨ç”Ÿæˆ
        const microTimestamp = Date.now() + Math.random() * 1000000;
        const cryptoRandom = Math.random().toString(36) + Math.random().toString(36);
        const userAgent = navigator.userAgent.replace(/\s+/g, '').substring(0, 20);
        const screenSignature = screen.width + screen.height + (screen.pixelDepth || 0);
        const memorySignature = navigator.hardwareConcurrency || Math.random();

        // çµ¶å¯¾ã«é‡è¤‡ã—ãªã„ä¸€æ„ã‚­ãƒ¼ç”Ÿæˆ
        const uniqueKey = `${microTimestamp}-${cryptoRandom}-${userAgent}-${screenSignature}-${memorySignature}-${performance.now()}`;
        const hashCode = uniqueKey.split('').reduce((a, b) => { a = ((a << 5) - a) + b.charCodeAt(0); return a & a; }, 0);

        script.src = `dist/pitchpro.umd.js?nuclear=${hashCode}&micro=${microTimestamp}&crypto=${cryptoRandom}&ua=${userAgent}&screen=${screenSignature}&mem=${memorySignature}&perf=${performance.now()}&rnd1=${Math.random()}&rnd2=${Math.random()}&rnd3=${Math.random()}&ts=${Date.now()}&force_reload=true&bypass_all=true&new_build=true`;

        // è¿½åŠ : scriptè¦ç´ è‡ªä½“ã‚‚å‹•çš„ã«å®Œå…¨å†ç”Ÿæˆ
        const oldScript = document.querySelector('script[src*="pitchpro.umd.js"]');
        if (oldScript) oldScript.remove();
        script.onload = function() {
            addLog('success', 'âœ… PitchPro ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿å®Œäº†');
            addLog('info', `ğŸ“ URL: ${script.src}`);

            // UMDãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ§‹é€ ç¢ºèª
            addLog('info', 'ğŸ” ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ§‹é€ ç¢ºèªä¸­...');

            // PitchProã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç¢ºèª
            if (typeof window.PitchPro !== 'undefined') {
                addLog('success', 'âœ… PitchPro ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç™ºè¦‹');
                console.log('PitchPro contents:', Object.keys(window.PitchPro));

                if (window.PitchPro.PitchDetector) {
                    addLog('success', 'âœ… PitchPro.PitchDetector ç¢ºèªå®Œäº†');
                    window.PitchDetector = window.PitchPro; // ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š
                } else {
                    addLog('error', 'âŒ PitchPro.PitchDetector ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
            } else if (typeof window.PitchDetector !== 'undefined') {
                addLog('success', 'âœ… PitchDetector ã‚¯ãƒ©ã‚¹ç¢ºèªå®Œäº†');
            } else {
                addLog('error', 'âŒ PitchDetector/PitchPro ã©ã¡ã‚‰ã‚‚è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                addLog('info', 'ğŸ” åˆ©ç”¨å¯èƒ½ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ:');
                const pitchRelated = Object.keys(window).filter(key =>
                    key.toLowerCase().includes('pitch') || key.toLowerCase().includes('audio')
                );
                console.log('Pitch/Audio related objects:', pitchRelated);
                pitchRelated.forEach(key => addLog('info', `  - ${key}`));
            }
        };
        script.onerror = function(error) {
            addLog('error', `âŒ ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿å¤±æ•—: ${error}`);
            addLog('info', `ğŸ” è©¦è¡ŒURL: ${script.src}`);
        };
        document.head.appendChild(script);

        let audioManager = null;
        let pitchDetector = null;
        let testTimeout = null;
        let isTestRunning = false;
        let logBuffer = [];

        function addLog(type, message) {
            const logContainer = document.getElementById('testLogs');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            const logText = `[${new Date().toLocaleTimeString()}] ${message}`;
            logEntry.innerHTML = logText;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;

            // ãƒ­ã‚°ãƒãƒƒãƒ•ã‚¡ã«è¿½åŠ ï¼ˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆç”¨ï¼‰
            logBuffer.push(logText);
        }

        function clearLogs() {
            document.getElementById('testLogs').innerHTML = '';
            logBuffer = [];
            addLog('info', 'ğŸ“„ ãƒ­ã‚°ã‚¯ãƒªã‚¢å®Œäº†');
        }

        function exportLogs() {
            const logText = logBuffer.join('\n');
            navigator.clipboard.writeText(logText).then(() => {
                addLog('success', 'âœ… ãƒ­ã‚°ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
            }).catch(err => {
                addLog('error', 'âŒ ãƒ­ã‚°ã®ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
                console.error('Copy error:', err);
            });
        }

        function stopTest() {
            isTestRunning = false;

            // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’ã‚¯ãƒªã‚¢
            if (testTimeout) {
                clearTimeout(testTimeout);
                testTimeout = null;
            }

            // ãƒ”ãƒƒãƒæ¤œå‡ºã‚’åœæ­¢
            if (pitchDetector) {
                pitchDetector.stopDetection();
                addLog('info', 'â¹ï¸ ãƒ”ãƒƒãƒæ¤œå‡ºåœæ­¢');
            }

            // ãƒªã‚½ãƒ¼ã‚¹ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
            if (audioManager) {
                audioManager.forceCleanup();
                audioManager = null;
                addLog('info', 'ğŸ§¹ AudioManagerã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†');
            }

            pitchDetector = null;

            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;

            addLog('info', 'ğŸ›‘ ãƒ†ã‚¹ãƒˆåœæ­¢å®Œäº†');
        }

        async function runConfigTest() {
            try {
                // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
                document.getElementById('startBtn').disabled = true;
                document.getElementById('stopBtn').disabled = false;
                isTestRunning = true;

                addLog('info', 'ğŸš€ è¨­å®šå€¤æ¤œè¨¼ãƒ†ã‚¹ãƒˆé–‹å§‹');

                // ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å–å¾—
                let PitchProLib = null;
                if (typeof window.PitchPro !== 'undefined') {
                    PitchProLib = window.PitchPro;
                    addLog('success', 'âœ… PitchPro ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä½¿ç”¨');
                } else if (typeof window.PitchDetector !== 'undefined') {
                    PitchProLib = window.PitchDetector;
                    addLog('success', 'âœ… PitchDetector ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä½¿ç”¨');
                } else {
                    addLog('error', 'âŒ ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒæœªå®šç¾© - èª­ã¿è¾¼ã¿ç¢ºèªãŒå¿…è¦');
                    return;
                }

                // AudioManageråˆæœŸåŒ–
                if (!PitchProLib.AudioManager) {
                    addLog('error', 'âŒ AudioManager ã‚¯ãƒ©ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    console.log('Available classes:', Object.keys(PitchProLib));
                    return;
                }

                audioManager = new PitchProLib.AudioManager();
                await audioManager.initialize();
                addLog('success', 'âœ… AudioManageråˆæœŸåŒ–å®Œäº†');

                // PitchDetectoråˆæœŸåŒ–ï¼ˆDeviceDetectionã®è¨­å®šã‚’é©ç”¨ï¼‰
                if (!PitchProLib.PitchDetector) {
                    addLog('error', 'âŒ PitchDetector ã‚¯ãƒ©ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }

                // DeviceDetectionã‹ã‚‰è¨­å®šã‚’å–å¾—
                const deviceSpecs = PitchProLib.DeviceDetection.getDeviceSpecs();
                addLog('info', `ğŸ“± Device: ${deviceSpecs.deviceType}, noiseGate: ${deviceSpecs.noiseGate}`);

                // PitchDetectorã«DeviceDetectionã®è¨­å®šã‚’æ¸¡ã™
                pitchDetector = new PitchProLib.PitchDetector(audioManager, {
                    minVolumeAbsolute: deviceSpecs.noiseGate  // 0.018ã‚’é©ç”¨
                });
                addLog('info', 'ğŸ”§ PitchDetectoråˆæœŸåŒ–ä¸­...');

                await pitchDetector.initialize();
                addLog('success', 'âœ… PitchDetectoråˆæœŸåŒ–å®Œäº†');

                // è¨­å®šå€¤ã®è©³ç´°ç¢ºèª
                const config = pitchDetector.config;
                addLog('info', 'ğŸ“Š è¨­å®šå€¤è©³ç´°ç¢ºèª:');

                // minVolumeAbsoluteç¢ºèª - PCç”¨ä¿®æ­£å€¤æ¤œè¨¼
                const actualMinVolume = config.minVolumeAbsolute;
                addLog('info', `  minVolumeAbsolute: ${actualMinVolume}`);

                // ğŸ” ãƒ‡ãƒãƒƒã‚°: config ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã‚’ç¢ºèª
                console.log('ğŸ” [Debug] Full config object:', config);
                console.log('ğŸ” [Debug] config keys:', Object.keys(config));
                addLog('info', `  æœŸå¾…å€¤ï¼ˆPCç”¨1.8%ï¼‰: 0.018`);

                if (Math.abs(actualMinVolume - 0.018) < 0.0001) {
                    addLog('success', 'âœ… minVolumeAbsolute = 0.018 (PCç”¨ãƒãƒ©ãƒ³ã‚¹èª¿æ•´å€¤ã¨ä¸€è‡´)');
                } else if (actualMinVolume === 0.009) {
                    addLog('warning', 'âš ï¸ minVolumeAbsolute = 0.009 (å‰å›ã®å€¤ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥å•é¡Œã®å¯èƒ½æ€§)');
                } else {
                    addLog('error', `âŒ minVolumeAbsolute = ${actualMinVolume} (æœŸå¾…å€¤: 0.018)`);
                }

                // ãƒã‚¤ã‚ºã‚²ãƒ¼ãƒˆé–¾å€¤è¨ˆç®—ï¼ˆPitchDetectorã§ã®å®Ÿéš›ã®è¨ˆç®—æ–¹æ³•ï¼‰
                const NOISE_GATE_SCALING_FACTOR = 500;
                const calculatedThreshold = actualMinVolume * NOISE_GATE_SCALING_FACTOR;
                addLog('info', `  è¨ˆç®—ã•ã‚ŒãŸãƒã‚¤ã‚ºã‚²ãƒ¼ãƒˆé–¾å€¤: ${calculatedThreshold.toFixed(2)}%`);
                addLog('info', `  æœŸå¾…å€¤ï¼ˆPCç”¨1.8%ï¼‰: 9.0%`);

                if (Math.abs(calculatedThreshold - 9.0) < 0.2) {
                    addLog('success', 'âœ… ãƒã‚¤ã‚ºã‚²ãƒ¼ãƒˆé–¾å€¤ = 9.0% (PCç”¨ãƒãƒ©ãƒ³ã‚¹èª¿æ•´å€¤ã¨ä¸€è‡´)');
                } else if (Math.abs(calculatedThreshold - 4.5) < 0.2) {
                    addLog('warning', 'âš ï¸ ãƒã‚¤ã‚ºã‚²ãƒ¼ãƒˆé–¾å€¤ = 4.5% (å‰å›ã®å€¤ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥å•é¡Œã®å¯èƒ½æ€§)');
                } else {
                    addLog('error', `âŒ ãƒã‚¤ã‚ºã‚²ãƒ¼ãƒˆé–¾å€¤ = ${calculatedThreshold.toFixed(2)}% (æœŸå¾…å€¤: 9.0%)`);
                }

                // è¨­å®šè¡¨ç¤ºã‚’æ›´æ–°
                const isCorrectValue = Math.abs(actualMinVolume - 0.018) < 0.0001;
                document.getElementById('configStatus').innerHTML = `
                    <div><strong>å®Ÿéš›ã®minVolumeAbsolute:</strong> <span class="value-highlight">${actualMinVolume}</span></div>
                    <div><strong>å®Ÿéš›ã®ãƒã‚¤ã‚ºã‚²ãƒ¼ãƒˆé–¾å€¤:</strong> <span class="value-highlight">${calculatedThreshold.toFixed(2)}%</span></div>
                    <div><strong>æœŸå¾…å€¤:</strong> <span class="value-highlight">0.018 (9.0%)</span></div>
                    <div><strong>åˆ¤å®š:</strong> <span class="${isCorrectValue ? 'success' : 'error'}">${isCorrectValue ? 'âœ… PCç”¨ãƒãƒ©ãƒ³ã‚¹èª¿æ•´å€¤' : 'âŒ ã‚­ãƒ£ãƒƒã‚·ãƒ¥å•é¡Œ'}</span></div>
                `;

                // ğŸ“Š ã‚·ãƒ³ãƒ—ãƒ«ãƒ­ã‚°ãƒ†ã‚¹ãƒˆ - é‡è¦æƒ…å ±ã®ã¿è¡¨ç¤º
                addLog('info', 'ğŸ¤ ãƒã‚¤ã‚ºã‚²ãƒ¼ãƒˆå‹•ä½œãƒ†ã‚¹ãƒˆé–‹å§‹ï¼ˆ5ç§’é–“ï¼‰');

                let updateCount = 0;
                let blockedCount = 0;
                let passedCount = 0;
                let maxVolume = 0;
                let minVolume = 100;

                pitchDetector.setCallbacks({
                    onPitchUpdate: function(result) {
                        if (!isTestRunning) return;

                        const volume = result.volume || 0;
                        if (volume > 0) {
                            passedCount++;
                            maxVolume = Math.max(maxVolume, volume);
                            minVolume = Math.min(minVolume, volume);

                            // æœ€åˆã®3å›ã¨10å›ãŠãã«è¡¨ç¤º
                            updateCount++;
                            if (updateCount <= 3 || updateCount % 10 === 0) {
                                addLog('success', `ğŸ”Š é€šé: ${volume.toFixed(1)}% (${updateCount}å›ç›®)`);
                            }
                        } else {
                            blockedCount++;
                        }
                    }
                });

                const started = pitchDetector.startDetection();
                if (started) {
                    addLog('success', 'âœ… ãƒ”ãƒƒãƒæ¤œå‡ºé–‹å§‹');

                    // 5ç§’å¾Œã«è‡ªå‹•åœæ­¢ + ã‚µãƒãƒªãƒ¼è¡¨ç¤º
                    testTimeout = setTimeout(() => {
                        if (isTestRunning) {
                            // ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼
                            addLog('info', 'ğŸ“Š === ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼ ===');
                            addLog('success', `ğŸ”Š é€šéã—ãŸä¿¡å·: ${passedCount}å›`);
                            addLog('info', `ğŸš« ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸä¿¡å·: ${blockedCount}å›`);
                            if (passedCount > 0) {
                                addLog('info', `ğŸ“ˆ éŸ³é‡ç¯„å›²: ${minVolume.toFixed(1)}% - ${maxVolume.toFixed(1)}%`);

                                // ãƒã‚¤ã‚ºã‚²ãƒ¼ãƒˆåŠ¹æœã®åˆ¤å®š
                                if (minVolume > 9.0) {
                                    addLog('success', 'âœ… ãƒã‚¤ã‚ºã‚²ãƒ¼ãƒˆæ­£å¸¸å‹•ä½œ (9.0%ä»¥ä¸Šã®ä¿¡å·ã®ã¿é€šé)');
                                } else {
                                    addLog('warning', 'âš ï¸ 9.0%æœªæº€ã®ä¿¡å·ãŒé€šé (è¨­å®šè¦ç¢ºèª)');
                                }
                            }

                            stopTest();
                            addLog('info', 'ğŸ¯ ãƒã‚¤ã‚ºã‚²ãƒ¼ãƒˆãƒ†ã‚¹ãƒˆå®Œäº†ï¼ˆ5ç§’çµŒéï¼‰');
                        }
                    }, 5000);
                } else {
                    addLog('error', 'âŒ ãƒ”ãƒƒãƒæ¤œå‡ºé–‹å§‹å¤±æ•—');
                    document.getElementById('startBtn').disabled = false;
                    document.getElementById('stopBtn').disabled = true;
                }

            } catch (error) {
                addLog('error', `âŒ ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                console.error('Test error:', error);

                // ã‚¨ãƒ©ãƒ¼æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                stopTest();
            }
        }

        function forceHardReload() {
            addLog('warning', 'ğŸš€ HARD RELOADå®Ÿè¡Œ - å…¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ä¸­...');

            // 1. Service Worker ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(registrations => {
                    registrations.forEach(registration => registration.unregister());
                });
            }

            // 2. ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¼·åˆ¶ã‚¯ãƒªã‚¢
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => caches.delete(name));
                });
            }

            // 3. LocalStorage/SessionStorage ã‚¯ãƒªã‚¢
            localStorage.clear();
            sessionStorage.clear();

            // 4. å®Œå…¨ãƒªãƒ­ãƒ¼ãƒ‰ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–ï¼‰
            setTimeout(() => {
                window.location.reload(true); // å¼·åˆ¶ãƒªãƒ­ãƒ¼ãƒ‰
            }, 1000);
        }
    </script>
</body>
</html>